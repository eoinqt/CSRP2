<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Single Egg - Fresh Eggs Scanner</title>
    <link rel="stylesheet" href="styles/main.css">
</head>

<body>
    <!-- Header Navigation -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <div class="nav-left">
                    <div class="hamburger-menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
                <div class="nav-right">
                    <a href="index.html" class="nav-btn btn-red">Home</a>
                    <a href="#contact" class="nav-btn">Contact</a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-left">
                        <h1 class="hero-title">
                            Fresh <span class="text-yellow">Eggs</span>, the<br>
                            Better
                        </h1>
                        <p class="hero-description">
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                            labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco
                            laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in
                            voluptate velit esse cillum dolore eu fugiat nulla pariatur.
                        </p>
                        <!--
                        <a href="#upload-section" class="btn btn-red hero-cta">SCAN YOUR EGGS HERE</a>
                        <p class="click-here">Click here!</p>
                        -->
                    </div>
                    <div class="hero-right">
                        <div class="yellow-circle"></div>
                        <div class="egg-bowl">
                            <div class="bowl-container">
                                <div class="bowl"></div>
                                <div class="eggs">
                                    <div class="egg"></div>
                                    <div class="egg"></div>
                                    <div class="egg"></div>
                                    <div class="egg"></div>
                                    <div class="egg"></div>
                                    <div class="egg"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Process Steps Section -->
        <section class="process-steps">
            <div class="container">
                <div class="steps-grid">
                    <div class="step">
                        <div class="step-icon yellow">1</div>
                        <h3 class="step-title">Upload<br>the Image<br>of the Eggs</h3>
                    </div>
                    <div class="step">
                        <div class="step-icon yellow">2</div>
                        <h3 class="step-title">Wait for the<br>Results</h3>
                    </div>
                    <div class="step">
                        <div class="step-icon green">3</div>
                        <h3 class="step-title">Results Are<br>Ready!</h3>
                    </div>
                </div>
            </div>
        </section>

        <!-- Individual Upload Section -->
        <section id="upload-section" class="upload-section">
            <div class="container">
                <div class="individual-indicator">
                    <div class="step">
                        <div class="step-icon yellow">ðŸ¥š</div>
                        <h3 class="step-title">Individual Egg Upload<br>Single Egg Scanning</h3>
                    </div>
                </div>

                <div class="upload-container">
                    <div class="upload-area">
                        <div class="upload-icon">
                            <div class="icon-image"></div>
                            <div class="icon-plus">+</div>
                            <img class="preview-image" style="display: none; width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                        </div>
                        <button class="btn btn-orange browse-btn"
                            onclick="browseFile()">BROWSE FILE</button>
                        <input type="file" id="fileInput" accept="image/*" style="display: none;">
                    </div>
                </div>
            </div>
        </section>

        <!-- Scan Button Section -->
        <section class="scan-button-section">
            <div class="container">
                <div class="text-center">
                    <button onclick="scanEgg()" class="btn btn-red scan-btn">
                        SCAN MY EGG!
                        <span class="arrow">â†’</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Guidelines Section -->
        <section class="guidelines">
            <div class="container">
                <!-- Guidelines for Single Egg -->
                <div class="guideline-section">
                    <div class="guideline-header yellow">Guidelines for Single Egg</div>
                    <div class="guideline-content">
                        <ol>
                            <li>Go to a shaded/dark area (the darker it is, the better)</li>
                            <li>Place Egg on top of source of light (flashlight, Camera light, etc.)</li>
                            <li>Take a picture of the top view of the light-reflected egg</li>
                            <li>Upload the egg to know the Results</li>
                        </ol>
                    </div>
                </div>

                <!-- Guidelines for Egg Scanning by Batch -->
                <div class="guideline-section">
                    <div class="guideline-header yellow">Guidelines for Egg Scanning by Batch</div>
                    <div class="guideline-content">
                        <ol>
                            <li>Go to a shaded/dark area (the darker it is, the better)</li>
                            <li>Prepare your DIY Egg Carton with Lights (how to do this is in the DIY instructions)</li>
                            <li>Place the eggs on the DIY Egg Carton</li>
                            <li>Take a picture of the top view of the light-reflected eggs</li>
                            <li>Upload the picture to know the Results</li>
                        </ol>
                    </div>
                </div>


            </div>
        </section>

        <!-- DIY Section -->
        <section class="diy-section">
            <div class="container">
                <h2 class="diy-title">DIY Egg Carton with Lights</h2>

                <div class="instructions-box">
                    <div class="instructions-header">Instructions</div>
                    <div class="instructions-content">
                        <ol>
                            <li>Get an egg carton and some candles (1-3 pcs.)</li>
                            <li>Prepare your DIY Egg Carton with Lights (how to do this is in the DIY instructions)</li>
                            <li>Light the candles</li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <!-- Footer content can be added here if needed -->
            </div>
        </footer>
    </main>

    <!-- Smooth Scrolling Script -->
    <script>
        // Function to trigger file input click
        function browseFile() {
            document.getElementById('fileInput').click();
        }

        // Handle file selection and preview
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewImage = document.querySelector('.preview-image');
                    const iconImage = document.querySelector('.icon-image');
                    const iconPlus = document.querySelector('.icon-plus');

                    previewImage.src = e.target.result;
                    previewImage.style.display = 'block';
                    iconImage.style.display = 'none';
                    iconPlus.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        });

        // Function to predict egg quality
        async function predictEggQuality(file) {
            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    displayResults(result);
                } else {
                    console.error('Prediction failed:', response.statusText);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Function to display prediction results
        function displayResults(result) {
            // Store results for the results page
            localStorage.setItem('eggQualityResults', JSON.stringify(result));
            // Re-enable the button
            const scanBtn = document.querySelector('.scan-btn');
            scanBtn.disabled = false;
            scanBtn.innerHTML = 'SCAN YOUR EGGS NOW!<span class="arrow">â†’</span>';
            // Navigate to results page
            window.location.href = 'individual-results.html';
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        function scanEgg() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (!file) {
                alert('Please select an image first!');
                return;
            }
            
            // Store the image data URL for display in results page
            const reader = new FileReader();
            reader.onload = function(e) {
                localStorage.setItem('uploadedIndividualImage', e.target.result);
                // Call prediction API
                predictEggQuality(file);
            };
            // Show loading or disable button
            const scanBtn = document.querySelector('.scan-btn');
            scanBtn.disabled = true;
            scanBtn.textContent = 'Scanning...';
            reader.readAsDataURL(file);
        }
    </script>
</body>

</html>